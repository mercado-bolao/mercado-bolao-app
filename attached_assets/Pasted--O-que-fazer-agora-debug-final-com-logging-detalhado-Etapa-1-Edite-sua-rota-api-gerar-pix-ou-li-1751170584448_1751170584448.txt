‚úÖ O que fazer agora: debug final com logging detalhado
Etapa 1 ‚Äî Edite sua rota /api/gerar-pix ou lib/criarPagamentoPix.ts com este bloco de tratamento de erro:
ts
Copiar
Editar
try {
  const token = await getToken();

  // Cria√ß√£o da cobran√ßa Pix
  const cobranca = await axios.put(
    `${BASE_URL}/v2/cob/${txid}`,
    {
      calendario: { expiracao: 3600 },
      devedor: { nome, cpf },
      valor: { original: valor.toFixed(2) },
      chave: process.env.EFI_PIX_KEY,
      solicitacaoPagador: `Pagamento de ${bilhetes} bilhete(s) - Bol√£o TVLoteca`,
      infoAdicionais: [...],
    },
    {
      headers: { Authorization: `Bearer ${token}` },
      httpsAgent: agent, // apenas se estiver em produ√ß√£o
    }
  );

  console.log('‚úÖ Cobran√ßa criada com sucesso:', cobranca.data);

  const locationId = cobranca.data.loc?.id;
  if (!locationId) {
    console.error('‚ùå loc.id ausente na resposta da cobran√ßa:', cobranca.data);
    return res.status(500).json({
      success: false,
      error: 'Cobran√ßa criada, mas n√£o foi poss√≠vel gerar o QR Code.',
    });
  }

  const qr = await axios.get(`${BASE_URL}/v2/loc/${locationId}/qrcode`, {
    headers: { Authorization: `Bearer ${token}` },
    httpsAgent: agent,
  });

  return res.status(200).json({
    success: true,
    pix: {
      payload: qr.data.qrcode,
      imagem: qr.data.imagemQrcode,
    },
  });
} catch (err) {
  console.error('‚ùå Erro ao gerar Pix completo:');
  console.error(JSON.stringify(err?.response?.data || err.message, null, 2));

  return res.status(500).json({
    success: false,
    error:
      err?.response?.data?.message ||
      err?.response?.data?.descricao ||
      'Erro inesperado ao gerar o pagamento PIX',
  });
}
Etapa 2 ‚Äî No frontend (pages/finalizar.tsx), adicione:
tsx
Copiar
Editar
console.error('Erro detalhado do backend:', data);
Assim voc√™ vai ver exatamente o data.error que o backend est√° enviando, e poder tratar de forma mais clara.

üí° Prov√°vel causa agora:
Como j√° validamos que a cobran√ßa foi criada com sucesso (recebeu txid e loc.id), ent√£o o erro est√° na segunda requisi√ß√£o: GET /v2/loc/:id/qrcode.

E isso pode acontecer por:

Token expirado

Falta de permiss√£o "loc > consultar"

Certificado mal referenciado

Falta do httpsAgent em produ√ß√£o

